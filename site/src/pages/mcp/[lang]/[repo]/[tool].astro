---
import Layout from '../../../../layouts/Layout.astro';
import { readFileSync, existsSync } from 'node:fs';
import { join } from 'node:path';
import { marked } from 'marked';

export function getStaticPaths() {
  const pub = join(process.cwd(), 'public');
  let manifest: { mcp_examples?: { language: string; repo: string; tools: string[] }[] } = { mcp_examples: [] };
  const manifestPath = join(pub, 'manifest.json');
  if (existsSync(manifestPath)) {
    try {
      manifest = JSON.parse(readFileSync(manifestPath, 'utf-8'));
    } catch (_) {}
  }
  const paths: { params: { lang: string; repo: string; tool: string }; props: { html: string } }[] = [];
  for (const ex of manifest.mcp_examples ?? []) {
    for (const tool of ex.tools) {
      const mdPath = join(pub, 'mcp', ex.language, ex.repo, `${tool}.md`);
      if (existsSync(mdPath)) {
        const md = readFileSync(mdPath, 'utf-8');
        const html = marked.parse(md, { async: false }) as string;
        paths.push({
          params: { lang: ex.language, repo: ex.repo, tool },
          props: { html },
        });
      }
    }
  }
  return paths;
}

const { lang, repo, tool } = Astro.params;
const { html } = Astro.props;
const base = import.meta.env.BASE_URL;
---

<Layout title={`${tool} â€” ${lang}/${repo}`} description={`MCP tool ${tool} for ${lang}/${repo}`}>
  <div class="space-y-8">
    <a href={`${base}mcp/`} class="mb-4 inline-flex items-center text-sm font-medium text-slate-600 no-underline transition hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2">
      <svg class="mr-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
      All MCP examples
    </a>

    <div class="rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
      <div class="prose prose-slate max-w-none prose-headings:font-semibold prose-h1:text-2xl prose-h2:mt-6 prose-h2:border-b prose-h2:border-slate-200 prose-h2:pb-2 prose-h2:text-lg prose-code:rounded prose-code:bg-slate-100 prose-code:px-1.5 prose-code:py-0.5 prose-code:before:content-none prose-code:after:content-none prose-pre:bg-slate-900 prose-pre:text-slate-100" set:html={html}></div>
    </div>
  </div>
</Layout>
